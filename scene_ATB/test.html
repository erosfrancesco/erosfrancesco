<head>
  	<title> Engine Headers </title>
</head>

<body>

    <style>
    
        #parent {
            display: table;
            margin: auto auto;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
        }
  
    </style>

    <div id="parent"></div>


    <script src='../engine/phaser.min.js'></script>
	<script src='../engine/colors.js'></script>


    <script src="../newMenu/Text.js"></script>
    <script src="../newMenu/Menu.js"></script>
    <script src="../newMenu/Background.js"></script>
    <script src="../newMenu/menuStyles.js"></script>
    <script src="../newMenu/FFVIMenu.js"></script>

    
    <!-- Battle headers -->
    <script src="../battle_headers/actionRegistry.js"></script>
    <script src="../battle_headers/characterRegistry.js"></script>
    <script src="../battle_headers/turnSystem.js"></script>
    <script src="../battle_headers/player.js"></script>
    <script src="../battle_headers/enemy.js"></script>
    <script src="../battle_headers/stat.js"></script>
    <script src="../battle_headers/battle.js"></script>
    <!-- -->

    <script src="../scene_ATB/Atb.js"></script>
    <script src="../scene_ATB/battle.js"></script>



    <script>


        class PreloadScene extends Phaser.Scene {

            constructor (config) {
                super(config);
                console.log('Preload scene built.');
            }

            preload () {
            }

            create () {
                


                /*
                this.menu = new FFVIMenu({
                    scene: this,
                    x: 200,
                    y: 200,
                    width: 300,
                    height: 150,
                    cullX: 1,
                    cullY: 1,
                    items: [[]]
                });

                this.a = new ATBLoadingBar({
                    x: 100,
                    y: 250,
                    width: 100,
                    scene: this
                });

                this.v = new ATBLoadingBar({
                    x: 100,
                    y: 150,
                    width: 100,
                    scene: this
                });



                // should tween

                this.a.addListener('done', e => console.log('super', e));

                this.v.addListener('done', e => console.log('duper', e));
                /**/


                /*

                // players
                let p1 = new Player({
                    commands: {},
                    name: "SuperPippo",
                    stats: {
                        "str": 50,
                        "dex": 1,
                        "lvl": 5
                    },
                    sprite: {}
                });

                // enemies
                let e1 = new Enemy({
                    commands: {},
                    name: 'BigBadFox',
                    stats: {
                        "str": 50,
                        "dex": 1,
                        "lvl": 5
                    },
                    sprite: {}
                });


                // player registry
                let Players = new CharacterRegistry({
                    characters: [p1],
                    /*
                    onAdd: player => { console.log(player, 'added'); },
                    onRemove: (player) => {
                        player.setDeadStatus();
                        if (!Player.length) {
                            //GAME.Over();
                        }
                    }
                    /**//*
                });

                // events dont work. WUT?
                //Players.addListener('adding', e => console.log('added') );

                // enemy registry
                let Enemies = new CharacterRegistry({
                    characters: [e1],
                    /*
                    onRemove: (enemy) => {
                        enemy.setDeadStatus();
                        if (!Enemies.length) {
                            //GAME.Win();
                        }
                    }
                    /**//*
                });
                
                // Set the turn system
                let ATBParam1 = 10;
                let Turn = new ATBTurnSystemCore({
                    formula: function (character, options) {
                        let dex = character.getVelocity();
                        if (character.type === 'Ally') {
                            dex += options.ATBParam1;
                        }
                        return dex;
                    },
                    parameters: { ATBParam1 }
                });

                // set the Animator
                let Animator = new PhaserAnimator();
                

                // Battle
                this.Battle = new Battle({
                    Animator,
                    Enemies,
                    Players,
                    Turn
                });
                /**/
              
            }

            update() {
                

                //this.Battle.update();
                
            }
        }

        
    </script>

    <script>

        let width = 900;
        let height = 500;

        let GAME = new Phaser.Game({
            width,
            height,
            pixelArt: true,
            parent: 'parent',
            background: '#00ff00'
        });

        GAME.scene.add('Preload', PreloadScene, true);

    </script>
</body>
