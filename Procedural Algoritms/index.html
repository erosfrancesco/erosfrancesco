<style>
    body { background-color: #222 }
</style>
<script src="phaser3/3.18.1.js"></script>
<script type="module" src="phaser3/index.js"></script>
<script type="module">

    const mapWidth = 80;
    const mapHeight = 80;
    const tileSize = 16;


    //
    import Cave from './cave.js';
    const GoLmap = new Cave(mapWidth, mapHeight, Cave.random(55));
    GoLmap.convertToTilemap = conversion => {
        const level = [[]];

        GoLmap.cellIterator(cell => {
            const {x, y} = cell;
            level[y] = level[y] || [];
            level[y][x] = conversion(cell);
        });

        return level;
    };

    const propertyName = "isWall";
    // GoLmap.addRule('Custom_Cave_Ruleset', (cell, neighbours) => {
        
	// 	const matchCells = GoLmap.countNeighbourProperty(propertyName, true, neighbours);

	// 	if (cell.state[propertyName]) {
	// 		if (matchCells === 8) {
	// 			cell.state[propertyName] = false;
	// 		}
	// 	}

	// 	return cell;
	// });

    GoLmap.update();
    //GoLmap.update();
    //GoLmap.update();


    //
    class CustomScene extends Phaser.Scene {
        constructor(...args) {
            super(...args)
        }

        static key = "GoL-View"

        preload() {
            const image = "https://miro.medium.com/max/1400/1*to2RUPNgu4VM8PPSLeOHHA.png"
            this.load.image("tiles", image);
        }

        create() {

            const level = GoLmap.convertToTilemap(cell => cell.state.isWall ? 15 : 20);

            const map = this.make.tilemap({ data: level, tileWidth: tileSize, tileHeight: tileSize });
            const tiles = map.addTilesetImage("test", "tiles");
            const layer = map.createDynamicLayer(0, tiles, 0, 0);
        }
    }

    Game.addScene(CustomScene, true);
</script>