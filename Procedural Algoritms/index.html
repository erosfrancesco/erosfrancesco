<style>
    body { background-color: #222 }
</style>
<script src="phaser3/3.18.1.js"></script>
<script type="module" src="phaser3/index.js"></script>
<script type="module">

    const mapWidth = 180;
    const mapHeight = 80;
    const p1 = 3;
    const p2 = 4;
    const tileSetSize = 48;
    const mapZoom = 0.5;
    
    import sampleData from './game_of_life/plugins/dataSample.js';
    import Utils from './game_of_life/plugins/utils.js';
    const {convertArrayToLayer, convertLayerToTilemap} = Utils;


    // import generateMap from './controllers/golController.js'
    // const GoLmap = generateMap(mapWidth, mapHeight, undefined, p1, p2);

    
    const GoLmap = convertArrayToLayer(mapWidth, mapHeight, sampleData);
    // GoLmap.update();
    // GoLmap.update();
    // GoLmap.update();

    // fill algorithm => clusters
    // corners recognition => filter clusters and set corners

    // import Utils from './game_of_life/utils.js';
    // console.log(Utils.fillIterator(GoLmap, 0, 0))

    import VectorCell from './game_of_life/plugins/vectorCell.js';
    const vectorCell = new VectorCell( 
        GoLmap, GoLmap.getCell(4, 6), 
        (currentCell, cell) => cell.state.valueConverted === currentCell.state.valueConverted);

    let index = 0
    while(vectorCell.updateTrail() && index < mapWidth * mapHeight * 4) {
        index++;
    }

    console.log(vectorCell.trail);
 
    import mapTemplate from './controllers/mapController.js';


    const map = mapTemplate('mapId', 
                            // "https://miro.medium.com/max/1400/1*to2RUPNgu4VM8PPSLeOHHA.png"
                            './borders-tileset-extruded.png', 
                            tileSetSize, tileSetSize, 
                            mapZoom, 
                            convertLayerToTilemap(GoLmap, cell => cell.state.valueConverted));


    //
    class CustomScene extends Phaser.Scene {
        constructor(...args) {
            super(...args)
        }

        static key = "GoL-View"

        preload() {
            map.preload(this);
        }

        create() {

            this.map = map.create(this, undefined, undefined, {
                "6": { "collide": true }
            });
            


            this.keyboardControls = Game.controller(this);
            const controlConfig = {
                camera: this.cameras.main,
                left: this.keyboardControls.left,
                right: this.keyboardControls.right,
                up: this.keyboardControls.up,
                down: this.keyboardControls.down,
                speed: 0.5,
                zoomIn: this.keyboardControls.primary,
                zoomOut: this.keyboardControls.secondary,
            };
            this.controls = new Phaser.Cameras.Controls.FixedKeyControl(controlConfig);


            // const tile = this.map.getTileAt(2, 2, false);
            // const {index, tilemapLayer} = tile;
            // console.log(index, tilemapLayer.properties);
        }

        update(time, delta) {
            this.controls.update(delta);
        }
    }

    Game.addScene(CustomScene, true);


</script>