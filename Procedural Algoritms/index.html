<script type="module">

    const mapWidth = 40;
    const mapHeight = 40;

    const createCell = (x, y) => {
        const width =  100 / mapWidth;
        const height = 100 / mapHeight;
        const div = document.createElement("div");
        div.id = "cell_" + x + "*" + y;
        div.style.position = "absolute";
        div.style.width = width + "%";
        div.style.height = height + "%";
        div.style.top = (width * x) + "%";
        div.style.left = (height * y) + "%";


        document.body.appendChild(div);
        return div;
    }
    const getCellDiv = (x, y) => {
        const id = "cell_" + x + "*" + y;
        return document.getElementById(id) || createCell(x, y);
    }

    //
    const threewayColorMap = state => {
        const stateColorMap = {
            1: "black",
            2: "blue",
            3: "white"
        };

        return stateColorMap[state.isWall];
    };

    const conwayColorMap = state => state.isAlive ? "black" : "white";
    const caveColorMap = state => state.isWall ? "black" : "white";

    //
    const draw = (map, colorMap) => {
        map.cellIterator(cell => {
            const {x, y, state} = cell;
            const div = getCellDiv(x, y);
            div.style.backgroundColor = colorMap(state)
        });
    };



    // import Threeway from './threeway.js';
    
    import Cave from './cave.js';
    const map = new Cave(mapWidth, mapHeight, Cave.random(55));

    // import Convay from './convay.js';
    // const map2 = new Convay(mapWidth, mapHeight, Convay.random(45));
    
    
    draw(map, caveColorMap)    
    setInterval(() => {
        map.update();
        draw(map, caveColorMap);
    }, 1000);

</script>