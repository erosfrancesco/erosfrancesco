<style>
    body { background-color: #222 }
</style>
<script src="phaser3/3.18.1.js"></script>
<script type="module" src="phaser3/index.js"></script>
<script type="module">
    // "https://miro.medium.com/max/1400/1*to2RUPNgu4VM8PPSLeOHHA.png"


    //
    import AssetsList from './config.js'
    const { cornerMap, property, solid, source } = AssetsList.mountain_terrain_zelda_like

    const mapWidth =  80
    const mapHeight = 80
    const tileSetSize = 32
    const tileSetOffset = 0
    const p1 = 2
    const p2 = 4

    //
    import caveGoLGenerator from './controllers/golController.js'
    const GoLmap = caveGoLGenerator(mapWidth, mapHeight, undefined, p1, p2)
    GoLmap.update()

    //
    import mapGenerator from './controllers/mapController.js'
    const o = mapGenerator(GoLmap, property, cornerMap, solid);

    // console.log(GoLmap)
 
    //
    import mapTemplate from './wrappers/phaserTilemapWrapper.js';
    const layerData = o.convertToTilemap((cell, wallStateValue) => {
        if (!wallStateValue && wallStateValue !== 0) {
            return 10 // solid
        }

        return wallStateValue
    });

    // import mapTemplate from './controllers/GoLCaveGen.js';
    // import Utils from './game_of_life/plugins/utils.js'
    // const { convertLayerToTilemap } = Utils;
    // const layerData = convertLayerToTilemap(GoLmap, cell => { return cell.state.isWall ? 9 : 5 }) 

    const map = mapTemplate( source, tileSetSize, tileSetSize, tileSetOffset, tileSetOffset, layerData );


    //
    class CustomScene extends Phaser.Scene {
        constructor(...args) {
            super(...args)
        }

        static key = "GoL-View"

        preload() {
            map.preload(this);
        }

        create() {
            this.map = map.create();
            
            this.keyboardControls = Game.controller(this);
            const controlConfig = {
                camera: this.cameras.main,
                left: this.keyboardControls.left,
                right: this.keyboardControls.right,
                up: this.keyboardControls.up,
                down: this.keyboardControls.down,
                speed: 0.5,
                zoomIn: this.keyboardControls.primary,
                zoomOut: this.keyboardControls.secondary,
            };
            this.controls = new Phaser.Cameras.Controls.FixedKeyControl(controlConfig);
        }

        update(time, delta) {
            this.controls.update(delta);
        }
    }

    Game.addScene(CustomScene, true);
</script>