<head>
  	<title> Battle test </title>
</head>

<body>

    <style>
    
        #parent {
            display: table;
            margin: auto auto;
        }

        body {
            margin: 1px;
            overflow: hidden;
            background-color: #555555;/**/
        }
  
    </style>

    <div id="parent"></div>


    <script src='../engine/phaser.min.js'></script>
	<script src='../engine/colors.js'></script>
    <script src='../engine/input.js'></script>

    <!-- Menu -->
    <script src="../menu_API/Text.js"></script>
    <script src="../menu_API/Menu.js"></script>
    <script src="../menu_API/MenuRegistry.js"></script>
    <script src="../menu_API/Background.js"></script>

    <script src="../menu_wrapper/triangleArrow.js"></script>
    <script src="../menu_wrapper/FFVIBackground.js"></script>
    <script src="../menu_wrapper/FFVIText.js"></script>
    <script src="../menu_wrapper/FFVIMenu.js"></script>
    <!-- -->

    
    <!-- Battle Headers -->
    <script src="../battle_API/character.js"></script>
    <script src="../battle_API/player.js"></script>
    <script src="../battle_API/enemy.js"></script>
    <script src="../battle_API/stat.js"></script>

    <script src='../battle_API/actionRegistry.js'></script>
    <script src="../battle_API/characterRegistry.js"></script>
    <script src="../battle_API/turnSystem.js"></script>
    <script src="../battle_API/battle.js"></script>
    <!-- -->
    

    <!-- ATB wrapper -->
    <script src="../ATB_battle_wrapper/ActionManager.js"></script>
    <script src="../ATB_battle_wrapper/Atb.js"></script>
    <script src="../ATB_battle_wrapper/TargetMenu.js"></script>
    <script src="../ATB_battle_wrapper/PlayerMenu.js"></script>
    <script src="../ATB_battle_wrapper/BattleUI.js"></script>
    <script src="../ATB_battle_wrapper/battleAtb.js"></script>
    <script src="../ATB_battle_wrapper/FightCommand.js"></script>
    <script src="../ATB_battle_wrapper/BattleMenu.js"></script>
    <!-- -->

    <!-- Characters -->


    <script src="../players/assets.js"></script>
    <script src="../players/Terra.js"></script>
    <script src="../players/Locke.js"></script>
    <script src="../players/Edgar.js"></script>
    <script src="../players/Shadow.js"></script>

    <script>


        class PreloadScene extends Phaser.Scene {

            constructor (config) {
                console.log('open battle!');
                super(config);
            }

            preload () {
                loadFFVICast(this);
                loadBattle01Assets(this);
                //this.load.image('background58', '../assets/resized.png');
                //this.load.image('kefka', '../assets/kefka-tolit.png');
            }

            create () {


                let background = this.make.image({key: 'backgroundBattle01', x: 350, y: 250 });
                             


                // Battle
                this.ATBBattle = new ATBBattle({ scene: this });


                this.shadow = new Shadow({
                    scene: this, 
                    battle: this.ATBBattle, 
                    configs: {
                        stats: {
                            "str": 50,
                            "dex": 4,
                            "lvl": 5,
                            "lif": 1900,
                            "man": 199
                        },
                        spriteKey: 'shadow',
                        x: 610,
                        y: 200
                    }
                });


                this.edgar = new Edgar({
                    scene: this, 
                    battle: this.ATBBattle, 
                    configs: {
                        stats: {
                            "str": 50,
                            "dex": 4,
                            "lvl": 5,
                            "lif": 1900,
                            "man": 199
                        },
                        spriteKey: 'edgar',
                        x: 540,
                        y: 250
                    }
                });
                

                this.locke = new Locke({
                    scene: this, 
                    battle: this.ATBBattle, 
                    configs: {
                        stats: {
                            "str": 50,
                            "dex": 4,
                            "lvl": 5,
                            "lif": 1900,
                            "man": 199
                        },
                        spriteKey: 'locke',
                        x: 520,
                        y: 325
                    }
                });
                

                this.terra = new Terra({
                    scene: this, 
                    battle: this.ATBBattle, 
                    configs: {
                        stats: {
                            "str": 50,
                            "dex": 4,
                            "lvl": 5,
                            "lif": 1900,
                            "man": 199
                        },
                        spriteKey: 'terra',
                        x: 450,
                        y: 400
                    }
                });


                

                

                let bossSprite = this.make.image({key: 'goblin_king_boss', x: 150, y: 200}); 
                bossSprite.scaleX = -0.75;
                bossSprite.scaleY = 0.75;


                let leprechaunSprite2 = this.make.image({key: 'leprechaun', x: 375, y: 230}); 
                leprechaunSprite2.scaleX = 0.25;
                leprechaunSprite2.scaleY = 0.25;

                let leprechaunSprite3 = this.make.image({key: 'leprechaun', x: 340, y: 340}); 
                leprechaunSprite3.scaleX = 0.25;
                leprechaunSprite3.scaleY = 0.25;

                let leprechaunSprite1 = this.make.image({key: 'leprechaun', x: 150, y: 400}); 
                leprechaunSprite1.scaleX = 0.25;
                leprechaunSprite1.scaleY = 0.25;

                // enemies
                this.e1 = new Enemy({
                    Commands: [
                    new FightCommand({battle: this.ATBBattle, scene: this}),
                    new ItemsCommand({battle: this.ATBBattle, scene: this})
                    ],
                    name: "Leprechaun",
                    stats: {
                        "str": 50,
                        "dex": 4,
                        "lvl": 5,
                        "lif": 1900,
                        "man": 199
                    },
                    sprite: leprechaunSprite1
                });

                this.e2 = new Enemy({
                    Commands: [
                    new FightCommand({battle: this.ATBBattle, scene: this}),
                    new ItemsCommand({battle: this.ATBBattle, scene: this})
                    ],
                    name: "Leprechaun",
                    stats: {
                        "str": 50,
                        "dex": 4,
                        "lvl": 5,
                        "lif": 1900,
                        "man": 199
                    },
                    sprite: leprechaunSprite2
                });

                this.e3 = new Enemy({
                    Commands: [
                    new FightCommand({battle: this.ATBBattle, scene: this}),
                    new ItemsCommand({battle: this.ATBBattle, scene: this})
                    ],
                    name: "Leprechaun",
                    stats: {
                        "str": 50,
                        "dex": 4,
                        "lvl": 5,
                        "lif": 1900,
                        "man": 199
                    },
                    sprite: leprechaunSprite3
                });

                this.boss = new Enemy({
                    Commands: [
                    new FightCommand({battle: this.ATBBattle, scene: this}),
                    new ItemsCommand({battle: this.ATBBattle, scene: this})
                    ],
                    name: "G. King",
                    stats: {
                        "str": 50,
                        "dex": 4,
                        "lvl": 5,
                        "lif": 1900,
                        "man": 199
                    },
                    sprite: bossSprite
                });

                //
                this.ATBBattle.addCharacters([ this.terra, this.locke, this.edgar, this.shadow], [this.e1, this.e2, this.e3, this.boss]);
                this.ATBBattle.init();

            }

            update() {
                this.ATBBattle.update();
            }
        }

        
    </script>

    <script>

        let width = 900;
        let height = 500;

        let GAME = new Phaser.Game({
            width,
            height,
            //pixelArt: true,
            parent: 'parent',
            background: '#00ff00'
        });

        GAME.scene.add('Preload', PreloadScene, true);

    </script>
</body>
